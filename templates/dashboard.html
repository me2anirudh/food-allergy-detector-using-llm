<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard — FoodAllergyDetect</title>

  <!-- LINKED CSS (this is the ONLY styling now) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
  <div class="page">
    <header>
      <div class="brand">
        <div class="logo">FA</div>
        <div>
          <div class="title">FoodAllergyDetect</div>
          <div class="muted">Welcome, {{ username }}</div>
        </div>
      </div>

      <div class="actions">
        <a class="btn" href="{{ url_for('allergies') }}">Edit Allergies</a>
        <a class="btn secondary" href="{{ url_for('logout') }}">Logout</a>
      </div>
    </header>

    <main>
      <div class="grid">
        <section class="card">
          <h1>Scan a product</h1>
          <p class="muted">Upload an image of ingredients and check allergen risk.</p>

          <div class="uploader">
            <input id="file" type="file" accept="image/*" />
            <button id="uploadBtn" class="btn">Upload & Scan</button>
            <div id="result"></div>
          </div>
        </section>

       <aside class="card">
  <h3>Your allergies</h3>
  <p class="muted">These allergens will be used for personalized warnings.</p>

  <div class="allergy-box">
    <strong class="muted">Manage your allergies</strong>

    <div class="allergy-btn-wrapper">
      <a class="btn allergy-btn" href="{{ url_for('allergies') }}">
        Edit Allergies
      </a>
    </div>
  </div>
</aside>

      </div>
    </main>

    <footer>
      © 2025 FoodAllergyDetect • Final Year B.Tech Project
    </footer>
  </div>

  <script>
    const uploadBtn = document.getElementById("uploadBtn");
    const fileInput = document.getElementById("file");
    const result = document.getElementById("result");

    uploadBtn.addEventListener("click", async () => {
      const f = fileInput.files[0];
      if (!f) { alert("Please choose an image first."); return; }

      const fd = new FormData();
      fd.append("image", f);
      result.textContent = "Scanning…";

      try {
        const res = await fetch("/predict_image", {
          method: "POST",
          body: fd
        });

        const data = await res.json();

        // Show ONLY allergy result to user — clean UI
        if (data.user_specific_risk && data.user_specific_risk.length > 0) {
          result.innerHTML = `
            <div class="alert bad">
              ⚠️ WARNING: This product contains allergens you are sensitive to:<br>
              <strong>${data.user_specific_risk.join(", ")}</strong>
            </div>
          `;
        } else {
          result.innerHTML = `
            <div class="alert good">
              ✅ SAFE: No matching allergens found for your allergy profile.
            </div>
          `;
        }

      } catch (err) {
        result.textContent = "Error uploading image.";
      }
    });
  </script>

</body>
</html>
